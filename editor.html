<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamWeb - EditÃ¶r Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #48bb78;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        /* --- ANÄ°MASYONLU ARKA PLAN --- */
        body { 
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center; 
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            overflow-x: hidden;
            position: relative;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bg-particle {
            position: fixed; bottom: -50px; color: rgba(255, 255, 255, 0.4);
            pointer-events: none; z-index: 0; will-change: transform;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            20% { opacity: 0.6; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }

        /* --- WRAPPER --- */
        .editor-wrapper { width: 100%; max-width: 650px; z-index: 10; position: relative; }

        /* --- GLASS PANEL --- */
        .editor-container { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 22px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); 
            overflow: hidden; 
        }

        .stepper-header { display: flex; justify-content: space-between; margin-bottom: 20px; position: relative; padding: 0 30px; margin-top: 25px; }
        .stepper-header::before { content: ""; position: absolute; top: 50%; left: 30px; right: 30px; height: 3px; background: #eee; z-index: 1; transform: translateY(-50%); }
        
        .step-circle { 
            width: 35px; height: 35px; background: white; border: 3px solid #eee; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; z-index: 2; 
            font-size: 14px; font-weight: 700; color: #ccc; transition: 0.3s;
        }
        .step-circle.active { background: var(--primary); border-color: var(--primary); color: white; transform: scale(1.1); box-shadow: 0 0 15px rgba(102,126,234,0.4); }
        .step-circle.completed { background: var(--success); border-color: var(--success); color: white; }

        .step-content { padding: 0 30px 30px 30px; display: none; }
        .step-content.active { display: block; animation: slideIn 0.4s ease; }

        h3 { font-size: 20px; margin-bottom: 20px; color: #2d3436; display: flex; align-items: center; gap: 10px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }

        /* --- FORM ELEMANLARI --- */
        .form-group { margin-bottom: 18px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px; color: #475569; }
        .input-style { width: 100%; padding: 12px 15px; background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; outline: none; transition: 0.3s; font-size: 14px; }
        .input-style:focus { border-color: var(--primary); background: white; }

        /* TEMA KARTLARI */
        .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .theme-card { background: #fff; border: 2px solid #e2e8f0; border-radius: 15px; padding: 15px; text-align: center; cursor: pointer; transition: 0.2s; }
        .theme-card:hover { transform: translateY(-3px); }
        .theme-card.selected { border-color: var(--primary); background: #f0f7ff; box-shadow: 0 5px 15px rgba(102,126,234,0.2); }
        .theme-card i { font-size: 28px; margin-bottom: 8px; display: block; }

        /* HÄ°KAYE KUTULARI */
        .timeline-editor-box {
            background: #fff; border: 1px solid #e2e8f0; padding: 15px; border-radius: 12px; margin-bottom: 15px; position: relative;
        }
        .timeline-editor-box h4 { font-size: 13px; color: var(--primary); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }

        /* FOTOÄžRAF GRID */
        .photo-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .photo-slot { aspect-ratio: 1; background: #f8fafc; border: 2px dashed #cbd5e0; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; overflow: hidden; transition: 0.2s; }
        .photo-slot:hover { border-color: var(--primary); background: #f0f7ff; }
        .photo-slot.has-img { border-style: solid; border-color: var(--success); }
        .photo-slot img { width: 100%; height: 100%; object-fit: cover; position: absolute; }
        .delete-btn { position: absolute; top: 5px; right: 5px; background: rgba(255,0,0,0.8); color: white; border: none; width: 20px; height: 20px; border-radius: 50%; display: none; cursor: pointer; font-size: 12px; z-index: 5; }

        /* ALT BUTONLAR */
        .footer-nav { padding: 20px 30px; background: #f8fafc; display: flex; justify-content: space-between; border-top: 1px solid #e2e8f0; }
        .btn { padding: 12px 25px; border-radius: 10px; font-weight: 600; cursor: pointer; border: none; transition: 0.2s; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .btn-next { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(102,126,234,0.3); }
        .btn-next:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102,126,234,0.4); }
        .btn-prev { background: #e2e8f0; color: #64748b; }
        .btn-prev:hover { background: #cbd5e0; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 500px) { .photo-grid { grid-template-columns: repeat(2, 1fr); } .stepper-header { padding: 0 15px; } .step-content { padding: 0 20px 20px 20px; } }
    </style>
</head>
<body>

<div class="editor-wrapper">
    <div class="stepper-header">
        <div class="step-circle active" id="dot1">1</div>
        <div class="step-circle" id="dot2">2</div>
        <div class="step-circle" id="dot3">3</div>
        <div class="step-circle" id="dot4">4</div>
    </div>

    <div class="editor-container">
        
        <div class="step-content active" id="step1">
            <h3><i class="fas fa-heart" style="color:#e74c3c"></i> Temel Bilgiler</h3>
            
            <div class="form-group">
                <label>Konsept SeÃ§ (Ä°Ã§erik Buna GÃ¶re DeÄŸiÅŸir)</label>
                <div class="theme-grid">
                    <div class="theme-card selected" onclick="selectTheme('love', this)">
                        <i class="fas fa-ring" style="color:#e74c3c"></i><strong>AÅŸk / Teklif</strong>
                    </div>
                    <div class="theme-card" onclick="selectTheme('birthday', this)">
                        <i class="fas fa-birthday-cake" style="color:#f1c40f"></i><strong>DoÄŸum GÃ¼nÃ¼</strong>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label id="lblPartner">Partnerinin AdÄ±</label>
                <input type="text" id="partnerName" class="input-style" placeholder="Ã–rn: AyÅŸem, CanÄ±m...">
            </div>

            <div class="form-group">
                <label id="lblDate">Ä°liÅŸki BaÅŸlangÄ±Ã§ Tarihi (SayaÃ§ Ä°Ã§in)</label>
                <input type="datetime-local" id="relationshipDate" class="input-style">
                <small style="color:#888; font-size:11px;" id="lblDateSmall">Buraya girdiÄŸin tarih ve saatten itibaren sayaÃ§ Ã§alÄ±ÅŸacak.</small>
            </div>

            <div class="form-group" style="margin-bottom: 0;">
                <label id="lblMsg">Ana Mesaj (Evet/HayÄ±r EkranÄ±)</label>
                <textarea id="proposalMessage" class="input-style" rows="2" placeholder="Ã–rn: Benimle evlenir misin?"></textarea>
            </div>
        </div>

        <div class="step-content" id="step2">
            <h3><i class="fas fa-history" style="color:#f1c40f"></i> Hikaye TÃ¼neli</h3>
            <p style="font-size:13px; color:#666; margin-bottom:20px; background:#f1f5f9; padding:10px; border-radius:8px;">
                SeÃ§tiÄŸin temaya gÃ¶re varsayÄ±lan metinler aÅŸaÄŸÄ±dadÄ±r. Ä°stersen deÄŸiÅŸtirebilirsin.
            </p>

            <div class="timeline-editor-box">
                <h4><i class="fas fa-flag-checkered"></i> 1. AÅŸama (BaÅŸlangÄ±Ã§)</h4>
                <div class="form-group">
                    <input type="text" id="t1_title" class="input-style" value="Hikayemiz BaÅŸladÄ±">
                </div>
                <div class="form-group" style="margin-bottom:0;">
                    <textarea id="t1_desc" class="input-style" rows="2">HayatÄ±mÄ±n en gÃ¼zel tesadÃ¼fÃ¼ seninle karÅŸÄ±laÅŸtÄ±ÄŸÄ±m o gÃ¼ndÃ¼...</textarea>
                </div>
            </div>

            <div class="timeline-editor-box">
                <h4><i class="fas fa-camera"></i> 2. AÅŸama (Orta)</h4>
                <div class="form-group">
                    <input type="text" id="t2_title" class="input-style" value="O BÃ¼yÃ¼lÃ¼ An">
                </div>
                <div class="form-group" style="margin-bottom:0;">
                    <textarea id="t2_desc" class="input-style" rows="2">GÃ¶zlerine ilk baktÄ±ÄŸÄ±mda evimi bulduÄŸumu hissettim.</textarea>
                </div>
            </div>

            <div class="timeline-editor-box">
                <h4><i class="fas fa-infinity"></i> 3. AÅŸama (Final)</h4>
                <div class="form-group">
                    <input type="text" id="t3_title" class="input-style" value="SonsuzluÄŸa Ä°lk AdÄ±m">
                </div>
                <div class="form-group" style="margin-bottom:0;">
                    <textarea id="t3_desc" class="input-style" rows="2">Ve bugÃ¼n, Ã¶mrÃ¼mÃ¼ seninle birleÅŸtirme sÃ¶zÃ¼ veriyorum.</textarea>
                </div>
            </div>
        </div>

        <div class="step-content" id="step3">
            <h3><i class="fas fa-photo-video" style="color:var(--secondary)"></i> Medya YÃ¼kle</h3>
            
            <div class="form-group">
                <label>Arka Plan MÃ¼ziÄŸi</label>
                <div style="display:flex; align-items:center; gap:10px;">
                    <input type="file" id="musicFile" accept="audio/*" class="input-style">
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 0;">
                <label>FotoÄŸraflar (8 Adet SeÃ§in)</label>
                <input type="file" id="bulkInput" multiple accept="image/*" style="display:none;">
                <button class="btn" onclick="document.getElementById('bulkInput').click()" style="width:100%; margin-bottom:15px; border:2px dashed #cbd5e0; color:#64748b; background:#f8fafc; justify-content:center;">
                    <i class="fas fa-plus-circle"></i> Toplu FotoÄŸraf SeÃ§
                </button>
                
                <div class="photo-grid">
                    <script>
                        for(let i=1; i<=8; i++) {
                            document.write(`
                                <div class="photo-slot" id="slot${i}" onclick="triggerInput(${i})">
                                    <input type="file" class="photo-input" id="input${i}" accept="image/*" style="display:none;" onchange="handleSingleFile(this, ${i})">
                                    <i class="fas fa-image" style="color:#cbd5e0; font-size:18px;"></i>
                                    <img src="" style="display:none;">
                                    <button class="delete-btn" onclick="removeImage(event, ${i})"><i class="fas fa-times"></i></button>
                                </div>
                            `);
                        }
                    </script>
                </div>
            </div>
        </div>

        <div class="step-content" id="step4">
            <div style="text-align:center; padding:30px 10px;">
                <div style="width:80px; height:80px; background:#dcfce7; color:#22c55e; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px auto; font-size:40px;">
                    <i class="fas fa-check"></i>
                </div>
                <h2 style="margin-bottom:10px;">Her Åžey HazÄ±r!</h2>
                <p style="color:#64748b; font-size:15px; line-height:1.6;">
                    Bilgileri girdin, hikayeni yazdÄ±n ve fotoÄŸraflarÄ± seÃ§tin.<br>
                    Åžimdi sihri baÅŸlatma zamanÄ±.
                </p>
                <div id="statusMessage" style="margin-top:20px; font-weight:600; font-size:14px; color:var(--primary); min-height:20px;"></div>
            </div>
        </div>

        <div class="footer-nav">
            <button class="btn btn-prev" id="prevBtn" onclick="changeStep(-1)" style="visibility:hidden;"><i class="fas fa-arrow-left"></i> Geri</button>
            <button class="btn btn-next" id="nextBtn" onclick="changeStep(1)">Devam Et <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyCuKzZVAA3K3dtlzxSmIc4h07CyqXMBk5Y", 
        authDomain: "lovespage61.firebaseapp.com", 
        projectId: "lovespage61", 
        storageBucket: "lovespage61.firebasestorage.app", 
        messagingSenderId: "954368938690", 
        appId: "1:954368938690:web:b6880d8524570e6e06a15b", 
        measurementId: "G-DR224E42S8" 
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const auth = getAuth(app);
    let currentUser = null;

    onAuthStateChanged(auth, u => { if(u) currentUser = u; else window.location.href="login.html"; });

    // --- ARKA PLAN EFEKTLERÄ° ---
    function startParticleFlow() {
        const symbols = ['â¤ï¸', 'ðŸ’', 'ðŸ’–', 'âœ¨'];
        setInterval(() => {
            const p = document.createElement('div');
            p.className = 'bg-particle';
            p.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
            p.style.left = Math.random() * 100 + 'vw';
            p.style.fontSize = (Math.random() * 15 + 10) + 'px';
            const duration = Math.random() * 8 + 7;
            p.style.animation = `floatUp ${duration}s linear forwards`;
            document.body.appendChild(p);
            setTimeout(() => p.remove(), duration * 1000);
        }, 1200);
    }
    startParticleFlow();

    // --- NAVIGASYON MANTIÄžI ---
    let currentStep = 1;
    let selectedTheme = 'love';
    const totalSteps = 4;

    window.changeStep = (n) => {
        if (n === 1 && !validateStep()) return;
        currentStep += n;
        
        if (currentStep > totalSteps) { 
            startCreation(); 
            return; 
        }
        
        updateUI();
    };

    function validateStep() {
        if (currentStep === 1) {
            const name = document.getElementById('partnerName').value.trim();
            const date = document.getElementById('relationshipDate').value;
            if (!name) { alert("Partnerinin ismini yazmalÄ±sÄ±n!"); return false; }
            if (!date) { alert("SayaÃ§ iÃ§in iliÅŸki tarihini seÃ§melisin!"); return false; }
        }
        if (currentStep === 3) {
            if (document.querySelectorAll('.photo-slot.has-img').length === 0) { 
                alert("En az 1 fotoÄŸraf yÃ¼klemelisin!"); 
                return false; 
            }
        }
        return true;
    }

    function updateUI() {
        document.querySelectorAll('.step-content').forEach((s, i) => s.classList.toggle('active', i === currentStep - 1));
        
        document.querySelectorAll('.step-circle').forEach((d, i) => {
            d.classList.toggle('active', i === currentStep - 1);
            d.classList.toggle('completed', i < currentStep - 1);
        });

        document.getElementById('prevBtn').style.visibility = currentStep === 1 ? 'hidden' : 'visible';
        
        const nextBtn = document.getElementById('nextBtn');
        if(currentStep === totalSteps) {
            nextBtn.innerHTML = 'OLUÅžTUR <i class="fas fa-magic"></i>';
            nextBtn.style.background = "linear-gradient(to right, #48bb78, #38a169)";
        } else {
            nextBtn.innerHTML = 'Devam Et <i class="fas fa-arrow-right"></i>';
            nextBtn.style.background = ""; // Reset
        }
    }

    // --- TEMA SEÃ‡Ä°MÄ° VE OTOMATÄ°K METÄ°N DEÄžÄ°ÅžÄ°MÄ° ---
    window.selectTheme = (t, el) => {
        selectedTheme = t;
        document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');

        // KRAL Ã–ZELLÄ°K BURADA: Metinleri temaya gÃ¶re deÄŸiÅŸtiriyoruz
        if(t === 'birthday') {
            document.getElementById('lblPartner').innerText = "DoÄŸum GÃ¼nÃ¼ Ã‡ocuÄŸunun AdÄ±";
            document.getElementById('partnerName').placeholder = "Ã–rn: CanÄ±m ArkadaÅŸÄ±m, AÅŸkÄ±m...";
            
            document.getElementById('lblDate').innerText = "DoÄŸum Tarihi (YaÅŸ SayacÄ± Ä°Ã§in)";
            document.getElementById('lblDateSmall').innerText = "Bu tarihe gÃ¶re 'DÃ¼nyayÄ± GÃ¼zelleÅŸtirdiÄŸin SÃ¼re' hesaplanacak.";
            
            document.getElementById('lblMsg').innerText = "Kutlama MesajÄ±";
            document.getElementById('proposalMessage').placeholder = "Ã–rn: Ä°yi ki doÄŸdun, iyi ki varsÄ±n!";
            document.getElementById('proposalMessage').value = "Ä°yi ki doÄŸdun! Nice mutlu yaÅŸlara... ðŸŽ‚";

            // Timeline DefaultlarÄ±
            document.getElementById('t1_title').value = "DÃ¼nyaya Merhaba";
            document.getElementById('t1_desc').value = "Senin doÄŸduÄŸun gÃ¼n, dÃ¼nya daha gÃ¼zel bir yer oldu.";
            
            document.getElementById('t2_title').value = "En GÃ¼zel AnÄ±lar";
            document.getElementById('t2_desc').value = "Birlikte biriktirdiÄŸimiz onca gÃ¼zel anÄ±dan sadece biri...";
            
            document.getElementById('t3_title').value = "Yeni YaÅŸÄ±n";
            document.getElementById('t3_desc').value = "Yeni yaÅŸÄ±nda tÃ¼m dileklerinin gerÃ§ekleÅŸmesini diliyorum.";
        
        } else {
            // AÅŸk Modu (VarsayÄ±lan)
            document.getElementById('lblPartner').innerText = "Partnerinin AdÄ±";
            document.getElementById('partnerName').placeholder = "Ã–rn: AyÅŸem, CanÄ±m...";
            
            document.getElementById('lblDate').innerText = "Ä°liÅŸki BaÅŸlangÄ±Ã§ Tarihi";
            document.getElementById('lblDateSmall').innerText = "Bu tarihten itibaren aÅŸk sayacÄ± Ã§alÄ±ÅŸacak.";

            document.getElementById('lblMsg').innerText = "Ana Mesaj (Evet/HayÄ±r EkranÄ±)";
            document.getElementById('proposalMessage').placeholder = "Ã–rn: Benimle evlenir misin?";
            document.getElementById('proposalMessage').value = ""; // KullanÄ±cÄ± kendi yazsÄ±n

            // Timeline DefaultlarÄ±
            document.getElementById('t1_title').value = "Hikayemiz BaÅŸladÄ±";
            document.getElementById('t1_desc').value = "HayatÄ±mÄ±n en gÃ¼zel tesadÃ¼fÃ¼ seninle karÅŸÄ±laÅŸtÄ±ÄŸÄ±m o gÃ¼ndÃ¼...";
            
            document.getElementById('t2_title').value = "O BÃ¼yÃ¼lÃ¼ An";
            document.getElementById('t2_desc').value = "GÃ¶zlerine ilk baktÄ±ÄŸÄ±mda evimi bulduÄŸumu hissettim.";
            
            document.getElementById('t3_title').value = "SonsuzluÄŸa Ä°lk AdÄ±m";
            document.getElementById('t3_desc').value = "Ve bugÃ¼n, Ã¶mrÃ¼mÃ¼ seninle birleÅŸtirme sÃ¶zÃ¼ veriyorum.";
        }
    };

    // --- FOTOÄžRAF MANTIÄžI ---
    window.triggerInput = (i) => document.getElementById(`input${i}`).click();
    window.handleSingleFile = (input, i) => { if(input.files[0]) showPreview(input.files[0], i); };
    
    document.getElementById('bulkInput').addEventListener('change', e => {
        const files = Array.from(e.target.files).slice(0, 8);
        files.forEach((file, i) => {
            const dt = new DataTransfer(); dt.items.add(file);
            const input = document.getElementById(`input${i+1}`);
            input.files = dt.files;
            showPreview(file, i+1);
        });
    });

    function showPreview(file, i) {
        const reader = new FileReader();
        reader.onload = e => {
            const slot = document.getElementById(`slot${i}`);
            const img = slot.querySelector('img');
            img.src = e.target.result; img.style.display = 'block';
            slot.querySelector('.fas').style.display = 'none';
            slot.querySelector('.delete-btn').style.display = 'block';
            slot.classList.add('has-img');
        };
        reader.readAsDataURL(file);
    }

    window.removeImage = (e, i) => {
        e.stopPropagation();
        const slot = document.getElementById(`slot${i}`);
        slot.querySelector('img').style.display = 'none';
        slot.querySelector('.fas').style.display = 'block';
        slot.querySelector('.delete-btn').style.display = 'none';
        slot.classList.remove('has-img');
        document.getElementById(`input${i}`).value = "";
    };

    // --- FIREBASE KAYIT (GÃœNCELLENDÄ°) ---
    async function startCreation() {
        const status = document.getElementById('statusMessage');
        const nextBtn = document.getElementById('nextBtn');
        nextBtn.disabled = true;
        status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Site oluÅŸturuluyor, lÃ¼tfen bekle...';

        try {
            // MÃ¼zik YÃ¼kle
            let musicUrl = "";
            const musicFile = document.getElementById('musicFile').files[0];
            if(musicFile) {
                status.innerHTML = 'ðŸŽµ MÃ¼zik sunucuya yÃ¼kleniyor...';
                const mRef = ref(storage, `users/${currentUser.uid}/music_${Date.now()}`);
                await uploadBytes(mRef, musicFile);
                musicUrl = await getDownloadURL(mRef);
            }

            // Resimler
            const imageUrls = [];
            const photoSlots = document.querySelectorAll('.photo-input');
            for(let i=0; i<photoSlots.length; i++) {
                const file = photoSlots[i].files[0];
                if(file) {
                    status.innerHTML = `ðŸ“¸ Resimler iÅŸleniyor (${i+1}/${photoSlots.length})...`;
                    const iRef = ref(storage, `users/${currentUser.uid}/img_${Date.now()}_${i}`);
                    await uploadBytes(iRef, file);
                    imageUrls.push(await getDownloadURL(iRef));
                }
            }

            // VeritabanÄ± KaydÄ± (YENÄ° ALANLAR Ä°LE)
            status.innerHTML = 'ðŸ’¾ Hikayeniz kaydediliyor...';
            
            await addDoc(collection(db, "proposals"), {
                userId: currentUser.uid, 
                theme: selectedTheme,
                partnerName: document.getElementById('partnerName').value,
                proposalMessage: document.getElementById('proposalMessage').value || "Sonsuza kadar EVET!",
                
                // YENÄ°: Ä°liÅŸki Tarihi
                relationshipDate: document.getElementById('relationshipDate').value,
                
                // YENÄ°: Timeline Verileri
                timeline: [
                    { 
                        title: document.getElementById('t1_title').value || "Hikayemiz BaÅŸladÄ±", 
                        desc: document.getElementById('t1_desc').value || "HayatÄ±mÄ±n en gÃ¼zel tesadÃ¼fÃ¼ seninle karÅŸÄ±laÅŸtÄ±ÄŸÄ±m o gÃ¼ndÃ¼..." 
                    },
                    { 
                        title: document.getElementById('t2_title').value || "O BÃ¼yÃ¼lÃ¼ An", 
                        desc: document.getElementById('t2_desc').value || "GÃ¶zlerine ilk baktÄ±ÄŸÄ±mda evimi bulduÄŸumu hissettim." 
                    },
                    { 
                        title: document.getElementById('t3_title').value || "SonsuzluÄŸa Ä°lk AdÄ±m", 
                        desc: document.getElementById('t3_desc').value || "Ve bugÃ¼n, Ã¶mrÃ¼mÃ¼ seninle birleÅŸtirme sÃ¶zÃ¼ veriyorum." 
                    }
                ],
                
                musicUrl: musicUrl, 
                images: imageUrls, 
                createdAt: new Date()
            });

            status.innerHTML = '<span style="color:var(--success)">âœ… BaÅŸarÄ±lÄ±! Paneline yÃ¶nlendiriliyorsun...</span>';
            setTimeout(() => window.location.href="dashboard.html", 2000);

        } catch(err) {
            console.error(err);
            status.innerHTML = `<span style="color:#e74c3c">Hata: ${err.message}</span>`;
            nextBtn.disabled = false;
        }
    }
</script>

</body>
</html>
