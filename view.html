<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√ºrpriz!</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* --- KUTLAMA SAYFASI √ñZEL CSS --- */
        #celebrationPage {
            display: none;
            width: 100%;
            min-height: 100vh;
            flex-direction: column;
            align-items: center;
            padding-bottom: 50px;
            opacity: 0;
            transition: opacity 1s ease;
            overflow-x: hidden;
        }

        .gallery-section {
            width: 100%;
            height: 85vh;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }

        .timer-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 50px;
            z-index: 20;
        }

        .timeline-section {
            width: 100%;
            max-width: 800px;
            position: relative;
            padding: 20px;
            margin-bottom: 50px;
        }
        
        .timeline-section::before {
            content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 4px; height: 100%; background: rgba(255, 255, 255, 0.3); border-radius: 2px;
        }

        .timeline-item {
            width: 100%; margin-bottom: 40px; position: relative; display: flex; justify-content: center;
        }
        
        .timeline-dot {
            position: absolute; left: 50%; top: 20px; transform: translateX(-50%);
            width: 20px; height: 20px; background: #fff; border: 4px solid #e73c7e;
            border-radius: 50%; z-index: 2; box-shadow: 0 0 15px rgba(231, 60, 126, 0.6);
        }

        .timeline-content {
            width: 45%; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px);
            padding: 20px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.3);
            color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .timeline-item:nth-child(odd) .timeline-content { margin-right: auto; text-align: right; }
        .timeline-item:nth-child(even) .timeline-content { margin-left: auto; text-align: left; }

        .timeline-date { font-size: 0.9rem; font-weight: 700; color: #ffd700; display: block; margin-bottom: 5px; }

        .promises-section {
            display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; padding: 20px;
        }
        .promise-card {
            background: rgba(255,255,255,0.9); padding: 20px; border-radius: 20px; width: 260px;
            text-align: center; color: #333; transform: rotate(-2deg); transition: 0.3s;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .promise-card:nth-child(2) { transform: rotate(2deg); margin-top: 20px; }
        .promise-card:hover { transform: scale(1.05) rotate(0deg); z-index: 10; }

        .love-timer-container { text-align: center; }
        .timer-box { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .time-segment {
            background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(5px);
            padding: 10px; border-radius: 10px; min-width: 70px;
            border: 1px solid rgba(255,255,255,0.3); color: white;
            display: flex; flex-direction: column; align-items: center;
        }
        .time-segment span { font-size: 1.5rem; font-weight: 700; }
        .time-segment label { font-size: 0.7rem; text-transform: uppercase; }

        @media (max-width: 768px) {
            .gallery-section { height: 60vh; }
            .timeline-section::before { left: 20px; }
            .timeline-dot { left: 20px; }
            .timeline-content { width: 80%; margin-left: 50px !important; text-align: left !important; }
            .timeline-item:nth-child(odd) .timeline-content { margin-right: 0; }
            .promise-card { width: 100%; transform: rotate(0deg) !important; margin-top: 10px !important; }
        }
    </style>
</head>
<body>
    
    <div id="startOverlay">
        <button class="start-btn" id="startBtn">S√ºrprizi Ba≈ülat ‚ù§Ô∏è</button>
    </div>

    <div class="background-overlay"></div>

    <div class="container" id="mainCard">
        <div class="card" data-aos="zoom-in" data-aos-duration="1200">
            <div class="content">
                <div id="iconContainer"></div>
                
                <h1 class="title" id="mainTitle"></h1>
                <p class="subtitle" id="mainSubtitle"></p>
            </div>
            
            <div class="buttons" id="btnGroup">
                <button class="btnYes" id="yesButton">EVET</button>
                <button class="btnNo" id="noButton">HAYIR</button>
            </div>
        </div>
    </div> 

    <div id="celebrationPage">
        
        <div class="gallery-section">
            <div class="box">
                <div class="dream" id="photoGallery"></div>
            </div>
        </div>

        <div class="timer-section" data-aos="fade-up">
            <h3 id="timerTitle" style="color:white; font-weight:300; letter-spacing:1px; margin-bottom:10px;">Seninle Ge√ßen Her Saniye...</h3>
            <div class="love-timer-container">
                <div class="timer-box">
                    <div class="time-segment"><span id="t-days">0</span><label>G√ºn</label></div>
                    <div class="time-segment"><span id="t-hours">00</span><label>Saat</label></div>
                    <div class="time-segment"><span id="t-minutes">00</span><label>Dk</label></div>
                    <div class="time-segment"><span id="t-seconds">00</span><label>Sn</label></div>
                </div>
            </div>
            <div style="margin-top:20px; color:rgba(255,255,255,0.8); font-size:0.9rem; animation: bounce 2s infinite;">
                <i class="fas fa-chevron-down"></i> A≈üaƒüƒ± Kaydƒ±r <i class="fas fa-chevron-down"></i>
            </div>
        </div>

        <div class="timeline-section">
            <div class="timeline-item" data-aos="fade-right">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <span class="timeline-date" id="date-meet">Ba≈ülangƒ±√ß</span>
                    <h3 id="t1-head">Hikayemiz Ba≈üladƒ±</h3>
                    <p id="t1-body">Hayatƒ±mƒ±n en g√ºzel tesad√ºf√º seninle kar≈üƒ±la≈ütƒ±ƒüƒ±m o g√ºnd√º...</p>
                </div>
            </div>
            <div class="timeline-item" data-aos="fade-left">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <span class="timeline-date">√ñzel An</span>
                    <h3 id="t2-head">O B√ºy√ºl√º An</h3>
                    <p id="t2-body">G√∂zlerine ilk baktƒ±ƒüƒ±mda evimi bulduƒüumu hissettim.</p>
                </div>
            </div>
            <div class="timeline-item" data-aos="fade-right">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <span class="timeline-date">Bug√ºn</span>
                    <h3 id="t3-head">Sonsuzluƒüa ƒ∞lk Adƒ±m</h3>
                    <p id="t3-body">Ve bug√ºn, √∂mr√ºm√º seninle birle≈ütirme s√∂z√º veriyorum.</p>
                </div>
            </div>
        </div>

        <div class="promises-section" data-aos="zoom-in" id="bottomCards">
            <div class="promise-card">
                <h3>‚ù§Ô∏è</h3>
                <p>Seni her g√ºn, ilk g√ºnk√º heyecanla seveceƒüime...</p>
            </div>
            <div class="promise-card">
                <h3>ü§ù</h3>
                <p>En zor g√ºnlerinde bile elini hi√ß bƒ±rakmayacaƒüƒ±ma...</p>
            </div>
            <div class="promise-card">
                <h3>üè°</h3>
                <p>Huzurlu, mutlu ve a≈ük dolu bir yuvamƒ±z olacaƒüƒ±na...</p>
            </div>
        </div>

        <h2 id="finalText" style="color:white; margin-bottom: 60px; text-shadow: 0 2px 10px rgba(0,0,0,0.3); text-align:center;">S√ñZ VERƒ∞YORUM ‚ù§Ô∏è</h2>

    </div>
    
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script> AOS.init({ duration: 1000, once: false }); </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyCuKzZVAA3K3dtlzxSmIc4h07CyqXMBk5Y", 
            authDomain: "lovespage61.firebaseapp.com", 
            projectId: "lovespage61", 
            storageBucket: "lovespage61.firebasestorage.app", 
            messagingSenderId: "954368938690", 
            appId: "1:954368938690:web:b6880d8524570e6e06a15b", 
            measurementId: "G-DR224E42S8" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- DAKTƒ∞LO EFEKTƒ∞ ---
        function typeWriter(elementId, text, speed, callback) {
            let i = 0;
            const element = document.getElementById(elementId);
            element.innerHTML = "";
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else { if (callback) callback(); }
            }
            type();
        }

        // --- SAYA√á FONKSƒ∞YONU ---
        function startLoveTimer(startDateStr) {
            // Eƒüer veri yoksa ≈üu anƒ± al
            const targetDate = startDateStr ? new Date(startDateStr).getTime() : new Date().getTime();
            
            // Timeline'daki tarihi g√ºncelle (TR formatƒ±nda)
            const dateObj = new Date(targetDate);
            document.getElementById('date-meet').innerText = dateObj.toLocaleDateString('tr-TR');

            function update() {
                const now = new Date().getTime();
                const gap = now - targetDate;

                const d = Math.floor(gap / (1000 * 60 * 60 * 24));
                const h = Math.floor((gap % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((gap % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((gap % (1000 * 60)) / 1000);

                document.getElementById('t-days').innerText = d;
                document.getElementById('t-hours').innerText = h < 10 ? '0'+h : h;
                document.getElementById('t-minutes').innerText = m < 10 ? '0'+m : m;
                document.getElementById('t-seconds').innerText = s < 10 ? '0'+s : s;
            }
            setInterval(update, 1000);
            update();
        }

        async function loadSiteData() {
            const urlParams = new URLSearchParams(window.location.search);
            const docId = urlParams.get('id');
            
            // VARSAYILAN BO≈û VERƒ∞LER (Hata vermemesi i√ßin)
            let data = {
                partnerName: "Misafir",
                proposalMessage: "Merhaba!",
                theme: "love", 
                musicUrl: "", 
                images: [],
                relationshipDate: "", 
                timeline: []
            };

            if (docId) {
                try {
                    const docSnap = await getDoc(doc(db, "proposals", docId));
                    if (docSnap.exists()) data = docSnap.data();
                } catch (error) { console.error("Hata:", error); }
            }

            const isBirthday = data.theme === 'birthday';

            // 1. ƒ∞KON ve RENKLER
            document.getElementById('iconContainer').innerHTML = isBirthday ? 
                `<div class="cake-wrapper"><div class="flame"></div><img src="https://i.ibb.co/2Z7fVfM/cake-icon.png" class="cake-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2682/2682431.png'"></div>` : 
                `<div class="ring-animation"><img src="https://pngimg.com/uploads/ring/ring_PNG26.png" class="ring-img"></div>`;
            
            document.getElementById('yesButton').innerHTML = isBirthday ? "KUTLA üéâ" : "EVET üíç";
            document.getElementById('noButton').innerHTML = isBirthday ? "HAYIR üéÇ" : "HAYIR üíî";

            // 2. TIMELINE VERƒ∞LERƒ∞ (Varsa doldur)
            if (data.timeline && data.timeline.length >= 3) {
                document.getElementById('t1-head').innerText = data.timeline[0].title;
                document.getElementById('t1-body').innerText = data.timeline[0].desc;
                
                document.getElementById('t2-head').innerText = data.timeline[1].title;
                document.getElementById('t2-body').innerText = data.timeline[1].desc;
                
                document.getElementById('t3-head').innerText = data.timeline[2].title;
                document.getElementById('t3-body').innerText = data.timeline[2].desc;
            }

            // 3. DOƒûUM G√úN√ú ƒ∞SE √ñZELLE≈ûTƒ∞R
            if(isBirthday) {
                // Saya√ß Ba≈ülƒ±ƒüƒ±
                document.getElementById('timerTitle').innerText = "D√ºnyayƒ± G√ºzelle≈ütirdiƒüin S√ºre...";
                
                // Alt Kartlar (Dilekler)
                document.getElementById('bottomCards').innerHTML = `
                    <div class="promise-card"><h3>üíä</h3><p>Yeni ya≈üƒ±nda saƒülƒ±k seninle olsun...</p></div>
                    <div class="promise-card"><h3>üöÄ</h3><p>T√ºm hayallerine ula≈ümanƒ± dilerim...</p></div>
                    <div class="promise-card"><h3>ü•≥</h3><p>Y√ºz√ºnden g√ºl√ºc√ºkler hi√ß eksik olmasƒ±n...</p></div>
                `;
                
                // Final Yazƒ±sƒ±
                document.getElementById('finalText').innerText = "ƒ∞Yƒ∞ Kƒ∞ DOƒûDUN! üéÇ";
            }

            // Galeri (Resim yoksa placeholder)
            const gallery = document.getElementById('photoGallery');
            const images = (data.images && data.images.length > 0) ? data.images : Array(8).fill("https://picsum.photos/400/600");
            images.forEach((imgUrl, index) => {
                if(index < 8) {
                    const span = document.createElement('span');
                    span.style.setProperty('--i', index + 1);
                    const img = document.createElement('img');
                    img.src = imgUrl;
                    span.appendChild(img);
                    gallery.appendChild(span);
                }
            });

            // Gƒ∞Rƒ∞≈û PERDESƒ∞
            document.getElementById('startBtn').addEventListener('click', () => {
                if (data.musicUrl) {
                    const audio = new Audio(data.musicUrl);
                    audio.volume = 0.6;
                    audio.play().catch(e => console.log("Ses hatasƒ±:", e));
                }
                const overlay = document.getElementById('startOverlay');
                overlay.style.opacity = '0';
                setTimeout(() => overlay.style.display = 'none', 1000);

                const titleText = isBirthday ? `ƒ∞yi Ki Doƒüdun ${data.partnerName}!` : `Benimle Evlenir Misin ${data.partnerName}?`;
                const subText = isBirthday ? "Nice mutlu ya≈ülara..." : "√ñmr√ºm√ºn geri kalanƒ± olur musun?";

                typeWriter("mainTitle", titleText, 90, () => {
                    typeWriter("mainSubtitle", subText, 50, () => {
                        document.getElementById('btnGroup').style.opacity = '1';
                    });
                });
            });

            // BUTON MANTIƒûI
            initLogic(data, isBirthday);
        }

        function initLogic(data, isBirthday) {
            const yesButton = document.getElementById('yesButton');
            const noButton = document.getElementById('noButton');
            const mainContainer = document.getElementById('mainCard');
            const celebrationPage = document.getElementById('celebrationPage');
            const title = document.querySelector('.title');
            
            let isYesClicked = false;
            let escapeCount = 0; 
            const noTexts = isBirthday ? 
                ["Emin misin?", "Pasta eridi!", "Yapma be!", "Hadi √ºfle!", "Tamam pes :)"] : 
                ["Emin misin?", "Bir daha d√º≈ü√ºn?", "Son kararƒ±n mƒ±?", "Kƒ±rma kalbimi...", "Basamazsƒ±n ki :)"];

            yesButton.addEventListener('click', function () {
                if (!isYesClicked) {
                    isYesClicked = true;
                    startConfetti(isBirthday ? 'üéâ' : '‚ù§Ô∏è');
                    
                    title.innerText = data.proposalMessage;
                    document.getElementById('mainSubtitle').innerText = isBirthday ? "ƒ∞yi ki varsƒ±n!" : 'Seni d√ºnyanƒ±n en mutlu insanƒ± yapacaƒüƒ±m...';
                    document.getElementById('btnGroup').style.display = 'none';
                    
                    setTimeout(() => {
                        mainContainer.style.opacity = "0";
                        setTimeout(() => { 
                            mainContainer.style.display = "none";
                            celebrationPage.style.display = "flex";
                            setTimeout(() => { 
                                celebrationPage.style.opacity = "1"; 
                                // SAYACI BA≈ûLAT (Burada data.relationshipDate kullanƒ±lƒ±r)
                                startLoveTimer(data.relationshipDate);
                            }, 100);
                        }, 500);
                    }, 2000); 
                }
            });

            function moveButton() {
                if (escapeCount < 5) {
                    noButton.innerText = noTexts[escapeCount];
                    const cardRect = document.querySelector('.card').getBoundingClientRect();
                    const btnWidth = noButton.offsetWidth;
                    const btnHeight = noButton.offsetHeight;
                    const maxX = cardRect.width - btnWidth - 20;
                    const maxY = cardRect.height - btnHeight - 20;
                    const x = Math.max(10, Math.random() * maxX);
                    const y = Math.max(10, Math.random() * maxY);
                    noButton.style.position = 'absolute';
                    noButton.style.left = x + 'px';
                    noButton.style.top = y + 'px';
                    escapeCount++;
                } else {
                    noButton.style.display = 'none';
                    title.innerText = isBirthday ? "Pastayƒ± √ºfle artƒ±k! üéÇ" : "Naz yapma prenses! üòâ";
                }
            }

            noButton.addEventListener('mouseover', moveButton);
            noButton.addEventListener('touchstart', (e) => { e.preventDefault(); moveButton(); });
        }

        function startConfetti(emoji) { 
            for(let i=0; i<80; i++) {
                setTimeout(() => { 
                    const h = document.createElement('div'); 
                    h.className='heart'; 
                    h.innerHTML= Math.random() > 0.5 ? emoji : '‚ú®'; 
                    h.style.left = Math.random() * 100 + 'vw';
                    const duration = Math.random() * 3 + 2; 
                    h.style.animationDuration = duration + 's';
                    h.style.fontSize = Math.random() * 20 + 20 + 'px';
                    document.body.appendChild(h); 
                    setTimeout(() => h.remove(), duration * 1000);
                }, i * 80); 
            } 
        }

        window.addEventListener('DOMContentLoaded', loadSiteData);
    </script>
</body>
</html>
